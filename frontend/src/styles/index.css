@tailwind base;
@tailwind components;
@tailwind utilities;

html,
body {
  height: 100%;
  overflow: hidden;
  /* prevent body bounce */
  overscroll-behavior: none;
  /* block viewport overscroll */
  background-color: var(--gh-canvas);
}

#app {
  height: 100dvh;
  /* lock to viewport height, safe on mobile */
  overflow-y: auto;
  /* scroll inside app container */
  overscroll-behavior: contain;
  /* prevent bubbling to viewport */
  -webkit-overflow-scrolling: touch;
}

/* Dark theme tokens (GitHub Primer Dark – tuned) */
:root,
.th-dark,
:root[data-theme="dark"] {
  /* App surfaces (Primer tokens) */
  /* Slightly lightened base to improve contrast and reduce "crushed" blacks */
  --gh-canvas: #0d1117;        /* color-canvas-default */
  --gh-canvas-subtle: #1a222c; /* a touch lighter than #161b22 for separation */
  --gh-border: #3a424a;        /* a bit brighter for clearer dividers */
  /* Text colors */
  --gh-muted: #9aa3ad;         /* slightly brighter muted text */
  /* Make default text brighter for readability */
  --gh-contrast: #ffffff;      /* bright default text */
  --gh-accent: #58a6ff;        /* color-accent-fg */
  --gh-green: #238636;         /* color-success-emphasis */
  --gh-green-hover: #2ea043;

  /* Tailwind color variables (RGB) for alpha-aware utilities */
  /* Neutral = Primer dark neutrals */
  --color-neutral-50: 240 246 252;  /* #f0f6fc */
  --color-neutral-100: 201 209 217; /* #c9d1d9 */
  --color-neutral-200: 177 186 196; /* #b1bac4 */
  --color-neutral-300: 139 148 158; /* #8b949e */
  --color-neutral-400: 110 118 129; /* #6e7681 */
  --color-neutral-500: 72 79 88;    /* #484f58 */
  --color-neutral-600: 48 54 61;    /* #30363d */
  --color-neutral-700: 33 38 45;    /* #21262d */
  --color-neutral-800: 22 27 34;    /* #161b22 */
  --color-neutral-900: 13 17 23;    /* #0d1117 */
  /* Make 950 less deep to reduce flatness when used as page background */
  --color-neutral-950: 13 17 23;    /* align with 900 for higher base brightness */

  /* Gray = use same mapping for text utilities */
  --color-gray-50: 240 246 252;
  /* Lighten grays used for text utilities to improve contrast */
  --color-gray-100: 245 247 249; /* #f5f7f9 */
  --color-gray-200: 228 233 238; /* #e4e9ee */
  --color-gray-300: 208 216 224; /* #d0d8e0 */
  --color-gray-400: 180 190 200; /* #b4bec8 */
  --color-gray-500: 72 79 88;
  --color-gray-600: 48 54 61;
  --color-gray-700: 33 38 45;
  --color-gray-800: 22 27 34;
  --color-gray-900: 13 17 23;
  --color-gray-950: 1 4 9;

  /* Blue scale (Primer blue) for link utilities */
  --color-blue-50: 235 245 255;   /* #ebf5ff */
  --color-blue-100: 202 232 255;  /* #cae8ff */
  --color-blue-200: 165 214 255;  /* #a5d6ff */
  --color-blue-300: 121 192 255;  /* #79c0ff */
  --color-blue-400: 88 166 255;   /* #58a6ff */
  --color-blue-500: 56 139 253;   /* #388bfd */
  --color-blue-600: 31 111 235;   /* #1f6feb */
  --color-blue-700: 17 88 199;    /* #1158c7 */
  --color-blue-800: 10 48 105;    /* #0a3069 */
  --color-blue-900: 0 29 61;      /* #001d3d */
  --color-blue-950: 0 20 41;      /* approx */

  /* Success (map to emerald utilities for buttons/toggles) */
  --color-emerald-300: 112 220 143; /* ~#70dc8f */
  --color-emerald-400: 63 185 80;   /* #3fb950 (Primer success.fg) */
  --color-emerald-500: 46 160 67;   /* #2ea043 (hover) */
  --color-emerald-600: 35 134 54;  /* #238636 (base) */
  --color-emerald-700: 31 111 47;  /* approx darker */
  /* Subtle background accents for gradients */
  --th-grad-a: rgba(88, 166, 255, 0.06);
  --th-grad-b: rgba(35, 134, 54, 0.05);
  /* Heatmap + calendar helpers */
  --heat-0: var(--color-neutral-800);
  --heat-1: var(--color-emerald-900);
  --heat-2: var(--color-emerald-700);
  --heat-3: var(--color-emerald-600);
  --heat-4: var(--color-emerald-500);
  --cal-filter: invert(0.9) hue-rotate(180deg);
  --radius-card: 12px;
  --shadow-card: 0 4px 16px rgba(0, 0, 0, 0.35);
}

/* Warm paper theme tokens */
:root[data-theme="warm"],
.th-warm {
  /* App surfaces */
  --gh-canvas: #f3e7d9;          /* warm base */
  --gh-canvas-subtle: #fff9f0;   /* lighter panels */
  --gh-border: #d8ccbe;          /* soft brown border */
  --gh-muted: #8b7e71;           /* muted text */
  --gh-contrast: #2f2a25;        /* primary text */
  --gh-accent: #7bb6d3;          /* soft blue accent */
  --gh-green: #6eac7d;           /* soft green */
  --gh-green-hover: #84be91;

  /* Neutral scale repurposed for light surfaces (kept semantic mapping) */
  --color-neutral-50: 143 131 117;   /* deep warm gray for rare usage */
  --color-neutral-100: 155 142 127;
  --color-neutral-200: 167 153 138;
  --color-neutral-300: 179 165 149;
  --color-neutral-400: 191 176 161;
  --color-neutral-500: 203 187 170;
  --color-neutral-600: 214 198 182;  /* borders */
  --color-neutral-700: 225 209 192;
  --color-neutral-800: 234 220 203;  /* panels */
  --color-neutral-900: 243 231 217;  /* base backgrounds */
  --color-neutral-950: 247 240 230;  /* page background */

  /* Grays for text utilities: low number = darker text (so text-gray-100 is dark) */
  --color-gray-50: 246 240 232;
  --color-gray-100: 47 42 37;      /* primary text */
  --color-gray-200: 66 59 52;      /* secondary text (darker for readability) */
  --color-gray-300: 94 84 75;      /* body-muted */
  --color-gray-400: 115 103 91;    /* subtle-muted */
  --color-gray-500: 161 146 131;
  --color-gray-600: 180 169 155;
  --color-gray-700: 198 188 175;
  --color-gray-800: 217 208 198;
  --color-gray-900: 237 230 222;
  --color-gray-950: 246 240 232;

  /* Soft blue scale for accents/links */
  --color-blue-50: 241 247 251;
  --color-blue-100: 216 234 246;
  --color-blue-200: 188 221 240;
  --color-blue-300: 159 205 231;
  --color-blue-400: 123 182 211;
  --color-blue-500: 106 165 195;
  --color-blue-600: 93 149 179;
  --color-blue-700: 79 133 163;
  --color-blue-800: 65 110 137;
  --color-blue-900: 53 91 114;
  --color-blue-950: 41 72 91;

  /* Soft green for success */
  --color-emerald-300: 184 224 191;
  --color-emerald-400: 156 207 166;
  --color-emerald-500: 132 190 145;
  --color-emerald-600: 110 172 125;
  --color-emerald-700: 92 149 107;

  /* Background accent tints */
  --th-grad-a: rgba(139, 126, 113, 0.10);
  --th-grad-b: rgba(168, 208, 197, 0.15);
  /* Themed helpers */
  --heat-0: var(--color-neutral-600);
  --heat-1: var(--color-emerald-300);
  --heat-2: var(--color-emerald-400);
  --heat-3: var(--color-emerald-500);
  --heat-4: var(--color-emerald-600);
  --cal-filter: none;
  --radius-card: 12px;
  --shadow-card: 0 6px 18px rgba(100, 80, 60, 0.18);
}

/* Sakura (light, blossom pink) */
:root[data-theme="sakura"],
.th-sakura {
  --gh-canvas: #fff6f9;          /* blossom base */
  --gh-canvas-subtle: #fffafd;   /* lighter panels */
  --gh-border: #f0d7e3;          /* rosy border */
  --gh-muted: #9a7b88;           /* muted text */
  --gh-contrast: #2f2329;        /* primary text */
  --gh-accent: #e07aa6;          /* sakura pink */
  --gh-green: #e1729e;           /* use brand as primary (maps to emerald utilities) */
  --gh-green-hover: #d96492;

  /* Neutral scale for light surfaces */
  --color-neutral-50: 150 132 143;
  --color-neutral-100: 168 150 160;
  --color-neutral-200: 206 181 192;  /* subtle lines */
  --color-neutral-300: 222 198 208;
  --color-neutral-400: 234 212 221;
  --color-neutral-500: 241 223 230;
  --color-neutral-600: 246 232 238;  /* borders */
  --color-neutral-700: 250 238 244;
  --color-neutral-800: 253 243 248;  /* panels */
  --color-neutral-900: 255 247 251;  /* base */
  --color-neutral-950: 255 250 253;  /* page */

  /* Grays for readable text on light pink */
  --color-gray-50: 252 248 250;
  --color-gray-100: 47 35 41;      /* primary text */
  --color-gray-200: 74 56 65;      /* secondary text */
  --color-gray-300: 102 80 90;     /* muted text */
  --color-gray-400: 131 108 118;   /* subtle */
  --color-gray-500: 160 138 148;
  --color-gray-600: 192 175 184;
  --color-gray-700: 216 203 210;
  --color-gray-800: 234 225 230;
  --color-gray-900: 246 241 244;
  --color-gray-950: 251 247 249;

  /* Blue scale remains for links */
  --color-blue-50: 246 240 255;
  --color-blue-100: 226 210 248;
  --color-blue-200: 203 178 240;
  --color-blue-300: 177 147 232;
  --color-blue-400: 153 124 222;
  --color-blue-500: 134 106 210;
  --color-blue-600: 116 91 191;
  --color-blue-700: 98 74 168;
  --color-blue-800: 79 60 143;
  --color-blue-900: 60 47 111;
  --color-blue-950: 44 35 85;

  /* Brand mapped to emerald utilities → pink scale */
  --color-emerald-300: 247 209 224; /* #f7d1e0 */
  --color-emerald-400: 239 168 196; /* #efa8c4 */
  --color-emerald-500: 232 140 177; /* #e88cb1 */
  --color-emerald-600: 225 114 158; /* #e1729e */
  --color-emerald-700: 196 88 132;  /* #c45884 */

  --th-grad-a: rgba(224, 122, 166, 0.10);
  --th-grad-b: rgba(253, 240, 244, 0.25);
  --heat-0: var(--color-neutral-600);
  --heat-1: var(--color-emerald-300);
  --heat-2: var(--color-emerald-400);
  --heat-3: var(--color-emerald-500);
  --heat-4: var(--color-emerald-600);
  --cal-filter: none;
  --radius-card: 14px; /* softer shape */
  --shadow-card: 0 6px 20px rgba(224, 122, 166, 0.18);
}

/* Theme helpers */
.gh-canvas {
  /* Add very subtle color variation with layered gradients */
  background:
    radial-gradient(900px 600px at 0% 0%, var(--th-grad-a), transparent 60%),
    radial-gradient(800px 500px at 100% 100%, var(--th-grad-b), transparent 60%),
    var(--gh-canvas);
}

/* Sakura decorative overlay (petals) */
:root[data-theme="sakura"] #app::before,
.th-sakura[data-demo]::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0.18;
  background-image: var(--sakura-overlay, url("data:image/svg+xml;utf8,\
    <svg xmlns='http://www.w3.org/2000/svg' width='320' height='320' viewBox='0 0 320 320'>\
      <rect width='320' height='320' fill='none'/>\
      <g fill='%23f2a0bd' fill-opacity='0.28'>\
        <ellipse cx='50' cy='50' rx='14' ry='9'/>\
        <ellipse cx='90' cy='70' rx='10' ry='6'/>\
        <ellipse cx='130' cy='40' rx='12' ry='8'/>\
        <ellipse cx='210' cy='80' rx='16' ry='10'/>\
        <ellipse cx='270' cy='60' rx='8' ry='5'/>\
      </g>\
      <g fill='%23f7cadb' fill-opacity='0.4'>\
        <circle cx='40' cy='140' r='8'/>\
        <circle cx='110' cy='120' r='6'/>\
        <circle cx='200' cy='150' r='7'/>\
        <circle cx='280' cy='130' r='8'/>\
        <circle cx='230' cy='220' r='10'/>\
        <circle cx='90' cy='220' r='9'/>\
      </g>\
      <g fill='%23eaa3be' fill-opacity='0.22'>\
        <ellipse cx='40' cy='260' rx='14' ry='9'/>\
        <ellipse cx='120' cy='280' rx='10' ry='6'/>\
        <ellipse cx='200' cy='260' rx='12' ry='8'/>\
        <ellipse cx='300' cy='250' rx='8' ry='5'/>\
      </g>\
    </svg>"));
  background-size: 340px 340px;
  background-repeat: repeat;
  z-index: 0;
}

/* Ensure app content is above overlay */
#app { position: relative; z-index: 1; }

/* Committers widget: ensure background follows theme (light themes especially) */
:root[data-theme="warm"] [data-widget="committers"],
:root[data-theme="sakura"] [data-widget="committers"] {
  background-color: var(--gh-canvas-subtle) !important;
  border: 1px solid var(--gh-border);
  border-radius: var(--radius-card, 12px);
  box-shadow: var(--shadow-card, none);
}

/* Slide-out group panel (left edge peek) */
.grp-panel { position: fixed; top: 12px; bottom: 12px; left: 0; width: 200px; background: rgba(0,0,0,.25); backdrop-filter: blur(5px) saturate(120%); border-right: 1px solid var(--gh-border); box-shadow: 0 8px 24px rgba(0,0,0,.35); transform: translateX(calc(-100% + 12px)); transition: transform .18s ease; z-index: 12; border-top-right-radius: 12px; border-bottom-right-radius: 12px; }
.grp-panel:hover { transform: translateX(0); }
:root[data-theme="warm"] .grp-panel, :root[data-theme="sakura"] .grp-panel { background: rgba(255,255,255,.55); }
.grp-content { height: 100%; padding: 10px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
.grp-peek { position: absolute; right: -12px; top: 42%; width: 12px; height: 120px; background: rgba(0,0,0,.35); border: 1px solid var(--gh-border); border-left: none; border-top-right-radius: 10px; border-bottom-right-radius: 10px; box-shadow: var(--shadow-card, none); }
:root[data-theme="warm"] .grp-peek, :root[data-theme="sakura"] .grp-peek { background: rgba(0,0,0,.18); }

.gh-canvas-subtle {
  background-color: var(--gh-canvas-subtle);
}

.gh-border {
  border-color: var(--gh-border);
}

/* Google Calendar iframe adapts to theme instantly */
.cal-body iframe { filter: var(--cal-filter); background-color: var(--gh-canvas); }

/* Browser-like project tabs: subtle hover-reveal for close button */
.tab-proj .tab-close { opacity: 0; pointer-events: none; transform: translateX(2px); transition: opacity .15s ease, transform .15s ease; }
.tab-proj:hover .tab-close { opacity: 1; pointer-events: auto; transform: translateX(0); }

.gh-text-muted {
  color: var(--gh-muted);
}

.gh-title {
  color: var(--gh-contrast);
}

.gh-card {
  background-color: var(--gh-canvas-subtle);
  border: 1px solid var(--gh-border);
  border-radius: var(--radius-card, 0.75rem);
  box-shadow: var(--shadow-card, none);
}

.btn-primary {
  background-color: var(--gh-green);
  color: white;
}

.btn-primary:hover {
  background-color: var(--gh-green-hover);
}

/* Improve default focus visibility */
button:focus-visible,
a:focus-visible,
input:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--gh-accent);
  outline-offset: 1px;
}

/* Placeholders readable but muted */
::placeholder {
  color: var(--gh-muted);
  opacity: 1; /* avoid extra fading on Safari */
}

/* Text selection contrast */
::selection {
  background: rgba(88, 166, 255, 0.25); /* blue-400/25 */
}

/* Slightly brighten default text */
body {
  color: var(--gh-contrast);
}

/* Keep defaults subtle and aligned with existing tabs */

/* ---- Animations (tasteful, motion-safe) ---- */
@keyframes viewFadeUp {
  from {
    opacity: 0;
    transform: translateY(6px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes overlayFade {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes popIn {
  from {
    opacity: 0;
    transform: scale(0.98);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

@media (prefers-reduced-motion: no-preference) {

  /* Page transition animation disabled per request */
  .fade-overlay {
    animation: overlayFade .18s ease-out both;
  }

  .pop-card {
    transition: transform .18s ease, box-shadow .18s ease;
  }

  .pop-card:hover {
    transform: translateY(-2px);
  }

.pop-modal {
  animation: popIn .18s ease-out both;
}

/* Consistent modal height across project (prevents layout jumps) */
.modal-fixed {
  height: 86vh;     /* unified modal height */
  max-height: 86vh; /* lock height even if content is shorter */
  display: flex;
  flex-direction: column;
}

  .btn-press {
    transition: transform .08s ease;
  }

  .btn-press:active {
    transform: translateY(1px);
  }
}

/* Make overflow containers scroll smoothly on iOS */
.overflow-y-auto,
.overflow-auto {
  -webkit-overflow-scrolling: touch;
}

/* ---- Honeycomb (Projects) ---- */
.hx-wrap { position: fixed; inset: 0; overflow: hidden; z-index: 0; }
.hx-canvas { position: absolute; left: 0; top: 0; transform-origin: 0 0; }
.hx-wrap, .hx-canvas, .hx-tile { user-select: none; -webkit-user-select: none; touch-action: none; }
/* Lock interaction behind modal overlays */
body[data-lock]:not([data-lock="0"]) .hx-wrap { pointer-events: none; }
.hx-tile { position: absolute; cursor: pointer; transition: transform .15s ease, filter .15s ease; }
.hx-clip { width: 100%; height: 100%; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); background: var(--gh-canvas-subtle); border: 1px solid var(--gh-border); border-radius: 8px; box-shadow: var(--shadow-card, none); overflow: hidden; position: relative; }
.hx-clip::before { content: ''; position: absolute; inset: 0; background: radial-gradient(120% 80% at 10% 0%, rgba(255,255,255,0.06), transparent 60%), radial-gradient(140% 100% at 100% 100%, rgba(0,0,0,0.06), transparent 60%); opacity: .8; }
.hx-info { position: absolute; inset: 0; display: grid; place-items: center; text-align: center; padding: 6px; opacity: 1; transition: opacity .15s ease, background .15s ease; backdrop-filter: saturate(120%) brightness(1.03); color: var(--gh-contrast); font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,.18); background: rgba(0,0,0,.14); }
.hx-tile:hover { filter: brightness(1.05); transform: translateY(-2px); }
.hx-tile:hover .hx-info { background: rgba(0,0,0,.22); }
.hx-img { position: absolute; inset: 0; object-fit: cover; opacity: .9; }
.hx-toolbar { position: absolute; right: 12px; top: 12px; z-index: 5; display: flex; gap: 6px; }
.hx-btn { padding: 6px 8px; border-radius: 8px; background: rgba(0,0,0,.22); color: white; border: 1px solid var(--gh-border); }
:root[data-theme="warm"] .hx-btn, :root[data-theme="sakura"] .hx-btn { background: rgba(255,255,255,.35); color: rgb(var(--color-gray-100)); }

/* Empty placeholder tiles to fill grid visually */
.hx-empty .hx-clip { background: rgba(0,0,0,.28) !important; border-color: rgba(0,0,0,.45) !important; filter: saturate(.7) brightness(.9); }
:root[data-theme="warm"] .hx-empty .hx-clip, :root[data-theme="sakura"] .hx-empty .hx-clip { background: rgba(0,0,0,.08) !important; border-color: rgba(0,0,0,.18) !important; }
.hx-empty .hx-info { opacity: 0 !important; }

/* Create-project tile visual */
/* Emphasized Create tile (black-ish, clear CTA) */
.hx-create .hx-clip {
  background: linear-gradient(135deg, rgba(10,10,10,.90), rgba(36,36,36,.95)) !important;
  border-color: rgba(255,255,255,.55) !important;
  border-style: dashed !important;
  box-shadow: 0 0 0 2px rgba(0,0,0,.6), 0 12px 30px rgba(0,0,0,.55);
}
.hx-create .hx-clip::before { opacity: .15; }
.hx-create .hx-info {
  opacity: 1 !important;
  background: rgba(0,0,0,.35);
  font-weight: 800;
  gap: 0;
  row-gap: 0;
  line-height: 1;
  padding: 4px;
}
.hx-create .hx-info .text-xs {
  display: inline-block;
  margin-bottom: -6px; /* tighten spacing to the plus */
  padding: 2px 8px;
  background: rgba(0,0,0,.65);
  color: #fff;
  border-radius: 9999px;
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 2px 10px rgba(0,0,0,.35);
}
.hx-create .hx-info .plus {
  display: grid;
  place-items: center;
  width: 36px;
  height: 36px;
  border-radius: 9999px;
  background: #fff;
  color: #000;
  font-size: 20px;
  font-weight: 900;
  line-height: 1;
  margin-top: -4px; /* pull closer to text */
  box-shadow: 0 0 0 2px rgba(0,0,0,.4), 0 4px 16px rgba(0,0,0,.35);
}
.hx-create .hx-tile:hover .hx-info { background: rgba(0,0,0,.45); }

/* Minimap */
.hx-mini { position: fixed; right: 14px; top: 16px; width: 140px; height: 140px; border-radius: 50%; background: rgba(0,0,0,.32); backdrop-filter: blur(4px) saturate(120%); border: 1px solid var(--gh-border); display: grid; place-items: center; z-index: 11; }
:root[data-theme="warm"] .hx-mini, :root[data-theme="sakura"] .hx-mini { background: rgba(255,255,255,.45); }
.hx-mini canvas { width: 120px; height: 120px; border-radius: 50%; }

/* ---- Honeycomb Widgets (Detail) ---- */
.hxw-wrap { position: absolute; inset: 0; overflow: hidden; z-index: 0; }
.hxw-canvas { position: absolute; left: 0; top: 0; transform-origin: 0 0; z-index: 1; }
.hxw-wrap, .hxw-canvas, .hxw-hex { user-select: none; -webkit-user-select: none; touch-action: none; }
/* Lock interaction behind modal overlays */
body[data-lock]:not([data-lock="0"]) .hxw-wrap { pointer-events: none; }
.hxw-hex { position: absolute; z-index: 0; }
.hxw-clip { width: 100%; height: 100%; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); background: var(--gh-canvas-subtle); border: 1px solid var(--gh-border); border-radius: 8px; overflow: hidden; }
.hxw-widget .hxw-clip { border: none !important; } /* 内部の区切り線は非表示（外周は別SVGで描画） */
.hxw-bg { position: absolute; inset: 0; z-index: 0; pointer-events: none; }
.hxw-ghost .hxw-clip { border: 2px dashed rgba(251,191,36,0.9); background: rgba(251,191,36,0.08); }
.hxw-widget { position: absolute; z-index: 2; }
.hxw-ghost { position: absolute; z-index: 3; }
.hxw-body { position: absolute; pointer-events: auto; z-index: 2; background: transparent; }
.hxw-body > .widget { position: absolute; inset: 0; width: 100%; height: 100%; }
.hxw-cells { position: absolute; inset: 0; z-index: 2; pointer-events: auto; }
.hxw-slot { position: absolute; }
.hxw-slot .hxw-clip { background: transparent; border: none; }
.hxw-slot .slot-inner { position: absolute; inset: 0; display: grid; place-items: center; padding: 6px; text-align: center; }
.hxw-widget[data-type="committers"] .hxw-slot .slot-inner { padding: 2px; }
.hxw-slot .slot-inner img { pointer-events: auto; }
.hxw-slot .slot-inner a, .hxw-slot .slot-inner input, .hxw-slot .slot-inner textarea, .hxw-slot .slot-inner button { pointer-events: auto; }

/* Removed the global infinite overlay to avoid covering UI */
.hxw-mini { position: fixed; right: 14px; top: 16px; width: 140px; height: 140px; border-radius: 50%; background: rgba(0,0,0,.32); backdrop-filter: blur(4px) saturate(120%); border: 1px solid var(--gh-border); display: grid; place-items: center; z-index: 11; }
:root[data-theme="warm"] .hxw-mini, :root[data-theme="sakura"] .hxw-mini { background: rgba(255,255,255,.45); }
.hxw-mini canvas { width: 120px; height: 120px; border-radius: 50%; }

/* Remove rectangular look for widgets placed in hex field */
.hxw-body .widget { background: transparent !important; box-shadow: none !important; border: none !important; border-radius: 0 !important; }
.hxw-body .gh-card { box-shadow: none !important; }
.hxw-body .wg-content { background: transparent !important; box-shadow: none !important; }
.hxw-body .md-widget,
.hxw-body .links-body,
.hxw-body .cal-body,
.hxw-body .flow-body,
.hxw-body .todo-body,
.hxw-body .tasksum-body { background: transparent; }
/* Contents should not set their own background; rely on hex background only */
.hxw-body .rounded, .hxw-body .rounded-md, .hxw-body .rounded-lg, .hxw-body .rounded-xl { border-radius: 0 !important; }

/* Contrast for empty vs filled hexes */
.hxw-hex .hxw-clip { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.18); }
:root[data-theme="warm"] .hxw-hex .hxw-clip, :root[data-theme="sakura"] .hxw-hex .hxw-clip { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.15); }
.hxw-filled .hxw-clip { background: rgba(59,130,246,0.22); border-color: rgba(59,130,246,0.50); }
:root[data-theme="warm"] .hxw-filled .hxw-clip, :root[data-theme="sakura"] .hxw-filled .hxw-clip { background: rgba(0,102,204,0.16); border-color: rgba(0,102,204,0.38); }

/* Add button on empty hex (hover) */
/* (hover add button reverted) */

/* Group quickbar (overlapped, enlarging active/hover) */
.group-quick .gq-icon {
  width: 36px;
  height: 36px;
  border-radius: 9999px;
  transition: transform .14s ease, box-shadow .14s ease, z-index .05s linear;
  position: relative;
  font-size: 14px;
  line-height: 1;
}
.group-quick .gq-icon:not(:first-child) { margin-left: -10px; }
/* Emphasis rules: only one at 1.3x (active or hovered) */
.group-quick .gq-active { transform: scale(1.3); box-shadow: none; }
.group-quick .gq-active.gq-suppressed { transform: scale(1); }
.group-quick .gq-hover { transform: scale(1.3); box-shadow: none; }

/* Make the add-circle readable at smaller size */
.group-quick #groupAddCircle { font-size: 18px; }

/* Route loading overlay */
.route-loading { position: fixed; inset: 0; z-index: 100; display: grid; place-items: center; background: #000;
  overflow: hidden;
}
/* Stage layout */
.route-loading .rl-stage { position: relative; width: 100%; height: 100%; }
.route-loading .rl-name { position: absolute; left: 50%; top: 46%; transform: translate(-50%, -50%); font-weight: 800; font-size: clamp(26px, 5vw, 52px); color: #fff; opacity: 0; filter: drop-shadow(0 6px 22px rgba(0,0,0,.45)); animation: rlName .5s ease forwards .1s; text-align: center; letter-spacing: .01em }
.route-loading .rl-bar { position: absolute; left: 50%; top: 66%; transform: translateX(-50%); width: min(24vw, 260px); height: 6px; border-radius: 9999px; background: rgba(255,255,255,.12); overflow: hidden }
.route-loading .rl-bar .rl-bar-fill { height: 100%; width: 0%; background: rgba(255,255,255,.9); animation: rlFill var(--rl-dur, 2000ms) linear forwards }
.route-loading .rl-burst { position: absolute; inset: 0; }
.route-loading .rl-pop { position: absolute; transform: translate(-50%, -50%) scale(.8); opacity: 0; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); background: var(--rl-col, #fff); border: 0; animation: rlPop .45s ease-out forwards; animation-delay: var(--rl-delay, 0ms); }
.route-loading .rl-burst { transform-origin: 50% 50%; }

@keyframes rlName { from { opacity: 0; transform: translate(-50%, -48%); } to { opacity: 1; transform: translate(-50%, -50%); } }
@keyframes rlFill { from { width: 0% } to { width: 100% } }
@keyframes rlPop { from { transform: translate(-50%, -50%) scale(.8); opacity: 0 } to { transform: translate(-50%, -50%) scale(1); opacity: 1 } }
/* Honeycomb background layers */
.route-loading::before,
.route-loading::after { content: ""; position: absolute; inset: -10%; pointer-events: none; opacity: .65; mix-blend-mode: overlay; }
/* Grid color varies by theme */
.route-loading { --rl-grid: rgba(255,255,255,.06) }
:root[data-theme="warm"] .route-loading,
:root[data-theme="sakura"] .route-loading { --rl-grid: rgba(0,0,0,.08) }

/* Big cells (slow drift) */
.route-loading::before { 
  background-image: url("data:image/svg+xml;utf8,\
    <svg xmlns='http://www.w3.org/2000/svg' width='96' height='84' viewBox='0 0 96 84'>\
      <g fill='none' stroke='white' stroke-opacity='.6' stroke-width='1.2'>\
        <polygon points='24,0 72,0 96,42 72,84 24,84 0,42'/>\
      </g>\
    </svg>");
  background-size: 96px 84px; 
  filter: drop-shadow(0 0 0 var(--rl-grid));
  animation: rlDrift 18s linear infinite;
}
/* Small cells (parallax) */
.route-loading::after {
  opacity: .45;
  background-image: url("data:image/svg+xml;utf8,\
    <svg xmlns='http://www.w3.org/2000/svg' width='64' height='56' viewBox='0 0 64 56'>\
      <g fill='none' stroke='white' stroke-opacity='.55' stroke-width='1.0'>\
        <polygon points='16,0 48,0 64,28 48,56 16,56 0,28'/>\
      </g>\
    </svg>");
  background-size: 64px 56px;
  filter: drop-shadow(0 0 0 var(--rl-grid));
  animation: rlDrift2 24s linear infinite reverse;
}

/* (Removed) card look inside hex; use hex fill so it blends */
.route-loading .rl-wrap { position: relative; width: 260px; height: 260px; }
.route-loading .rl-hex { position: absolute; inset: 0; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); border: 2px solid var(--gh-border); }
.route-loading .rl-hex-a { transform: scale(1); animation: rlPulse 1.4s ease-in-out infinite; background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(0,0,0,.08)); }
.route-loading .rl-hex-b { transform: scale(.75) rotate(15deg); animation: rlSpin 2.4s linear infinite; border-color: var(--gh-accent); }
.route-loading .rl-hex-c { transform: scale(.5) rotate(-15deg); animation: rlSpin 3s linear infinite reverse; border-color: var(--gh-green); }
.route-loading .rl-text { position: absolute; inset: 0; display: grid; place-items: center; gap: 6px; flex-direction: column; }
.route-loading .rl-text .rl-word { 
  font-weight: 800; 
  font-size: 48px; 
  letter-spacing: .06em; 
  text-transform: uppercase; 
  background: linear-gradient(90deg, var(--gh-contrast), var(--gh-accent));
  -webkit-background-clip: text; background-clip: text; color: transparent; 
  text-shadow: 0 2px 8px rgba(0,0,0,.25);
}
.route-loading .rl-text .rl-dots { margin-left: 6px; display: inline-block; }
.route-loading .rl-text .rl-dots i { display:inline-block; width: .3em; text-align:center; color: var(--gh-contrast); opacity: .25; font-size: 46px; line-height: 1; animation: rlDots 1.2s infinite steps(1,end); }
.route-loading .rl-text .rl-dots i:nth-child(1){ animation-delay: 0s }
.route-loading .rl-text .rl-dots i:nth-child(2){ animation-delay: .2s }
.route-loading .rl-text .rl-dots i:nth-child(3){ animation-delay: .4s }

@keyframes rlPulse { 0% { transform: scale(1); opacity: .8 } 50% { transform: scale(1.06); opacity: 1 } 100% { transform: scale(1); opacity: .8 } }
@keyframes rlSpin { from { transform: rotate(0deg) scale(var(--rl-s,1)); } to { transform: rotate(360deg) scale(var(--rl-s,1)); } }
@keyframes rlDrift { from { transform: translateX(0) translateY(0); } to { transform: translateX(96px) translateY(84px); } }
@keyframes rlDrift2 { from { transform: translateX(0) translateY(0); } to { transform: translateX(-64px) translateY(56px); } }
@keyframes rlDots { 0% { opacity: .25 } 50% { opacity: 1 } 100% { opacity: .25 } }

/* Circle transition overlay */
.circle-trans { position: fixed; inset: 0; z-index: 120; pointer-events: none; }
.circle-trans { background: transparent }
.circle-trans::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,.9); 
  clip-path: circle(125vmax at var(--cx) var(--cy));
  animation: ctClose .34s ease-in forwards;
}
.circle-trans.ct-fade { animation: ctFade .2s ease forwards; }

@keyframes ctClose { from { clip-path: circle(125vmax at var(--cx) var(--cy)); } to { clip-path: circle(0 at var(--cx) var(--cy)); } }
@keyframes ctFade { from { opacity: 1 } to { opacity: 0 } }

/* Center edit-forms inside hex widgets */
.hxw-body [data-center="1"] { display: grid !important; align-items: center !important; justify-items: center !important; }
.hxw-body .lnk-form, .hxw-body .cal-form { max-width: min(560px, 92%); width: 100%; margin: 0 auto; }
/* Ensure inputs/buttons are interactive above any overlays */
.hxw-body input, .hxw-body textarea, .hxw-body select, .hxw-body button { position: relative; z-index: 5; pointer-events: auto; }
